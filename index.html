<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üü¶ Boxy ‚Äì Modern Canvas Playground</title>
<style>
  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  .header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    padding: 20px;
    text-align: center;
  }

  .header h1 {
    margin: 0;
    font-size: 2rem;
    font-weight: 700;
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .header p {
    margin: 5px 0 0 0;
    color: #666;
    font-size: 0.9rem;
  }

  #toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    align-items: center;
    justify-content: center;
    padding: 20px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    margin: 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .btn {
    padding: 12px 24px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    border-radius: 50px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
  }

  .btn:before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.5s;
  }

  .btn:hover:before {
    left: 100%;
  }

  .btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
  }

  .btn-danger {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    color: white;
  }

  .btn-danger:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
  }

  .color-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(255, 255, 255, 0.7);
    padding: 8px 16px;
    border-radius: 50px;
    border: 2px solid rgba(102, 126, 234, 0.2);
    transition: all 0.3s ease;
  }

  .color-input-wrapper:hover {
    border-color: rgba(102, 126, 234, 0.5);
    background: rgba(255, 255, 255, 0.9);
  }

  .color-input-wrapper label {
    font-weight: 600;
    color: #333;
    font-size: 14px;
  }

  #colorPicker {
    width: 40px;
    height: 40px;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transition: transform 0.2s ease;
  }

  #colorPicker:hover {
    transform: scale(1.1);
  }

  .canvas-container {
    display: flex;
    justify-content: center;
    align-items: center;
    flex: 1;
    padding: 20px;
  }

  #canvas {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  #canvas:hover {
    transform: translateY(-2px);
    box-shadow: 0 25px 80px rgba(0, 0, 0, 0.25);
  }

  #info {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 8px 16px;
    border-radius: 50px;
    font-weight: 600;
    font-size: 14px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    min-width: 180px;
    text-align: center;
  }

  .controls-group {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  @media (max-width: 768px) {
    .header h1 {
      font-size: 1.5rem;
    }

    #toolbar {
      flex-direction: column;
      gap: 10px;
    }

    .controls-group {
      flex-direction: column;
      width: 100%;
    }

    .btn {
      width: 100%;
      max-width: 200px;
    }

    #canvas {
      max-width: 90vw;
      max-height: 60vh;
    }
  }

  .fade-in {
    animation: fadeIn 0.6s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .rectangle-animation {
    animation: rectangleAppear 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  @keyframes rectangleAppear {
    from {
      transform: scale(0);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }
</style>
</head>
<body>

<div class="header fade-in">
  <h1>üü¶ Boxy</h1>
  <p>Modern Canvas Playground for Creative Rectangle Design</p>
</div>

<div id="toolbar" class="fade-in">
  <div class="controls-group">
    <button id="addRect" class="btn btn-primary">‚ú® Add Rectangle</button>
    <button id="deleteRect" class="btn btn-danger">üóëÔ∏è Delete Selected</button>
  </div>

  <div class="color-input-wrapper">
    <label>üé® Color:</label>
    <input type="color" id="colorPicker" value="#667eea">
  </div>

  <div id="info">No selection</div>
</div>

<div class="canvas-container">
  <canvas id="canvas" width="800" height="500" class="fade-in"></canvas>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const addBtn = document.getElementById("addRect");
const deleteBtn = document.getElementById("deleteRect");
const colorPicker = document.getElementById("colorPicker");
const info = document.getElementById("info");

let rectangles = [];
let selected = null;
let dragOffset = { x: 0, y: 0 };
let resizing = false;

const HANDLE_SIZE = 10;
const GRID_SIZE = 20; // px

// px ‚Üí mm (assuming 96 dpi)
const PX_TO_MM = 25.4 / 96;

// Modern color palette
const modernColors = [
  "#667eea", "#764ba2", "#f093fb", "#f5576c",
  "#4facfe", "#00f2fe", "#43e97b", "#38f9d7",
  "#ffecd2", "#fcb69f", "#a8edea", "#fed6e3"
];

// --- Helpers ---

function getRandomModernColor() {
  return modernColors[Math.floor(Math.random() * modernColors.length)];
}

function drawGrid() {
  ctx.save();
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Modern gradient background
  const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
  gradient.addColorStop(0, "#f8fafc");
  gradient.addColorStop(1, "#e2e8f0");
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Subtle grid lines
  ctx.strokeStyle = "rgba(148, 163, 184, 0.2)";
  ctx.lineWidth = 1;

  // vertical lines
  for (let x = 0; x <= canvas.width; x += GRID_SIZE) {
    ctx.beginPath();
    ctx.moveTo(x + 0.5, 0);
    ctx.lineTo(x + 0.5, canvas.height);
    ctx.stroke();
  }

  // horizontal lines
  for (let y = 0; y <= canvas.height; y += GRID_SIZE) {
    ctx.beginPath();
    ctx.moveTo(0, y + 0.5);
    ctx.lineTo(canvas.width, y + 0.5);
    ctx.stroke();
  }

  ctx.restore();
}

function drawRectangle(r, isSelected = false) {
  // Modern rectangle with gradient and shadow
  ctx.save();

  if (isSelected) {
    // Glow effect for selected rectangle
    ctx.shadowColor = "rgba(102, 126, 234, 0.4)";
    ctx.shadowBlur = 20;
    ctx.shadowOffsetX = 0;
    ctx.shadowOffsetY = 0;
  }

  // Main rectangle
  ctx.fillStyle = r.color;
  ctx.fillRect(r.x, r.y, r.w, r.h);

  // Subtle inner shadow for depth
  const gradient = ctx.createLinearGradient(r.x, r.y, r.x, r.y + r.h);
  gradient.addColorStop(0, "rgba(255, 255, 255, 0.3)");
  gradient.addColorStop(1, "rgba(0, 0, 0, 0.1)");
  ctx.fillStyle = gradient;
  ctx.fillRect(r.x, r.y, r.w, r.h);

  ctx.restore();

  if (isSelected) {
    // Modern selection border
    ctx.save();
    ctx.strokeStyle = "#667eea";
    ctx.lineWidth = 3;
    ctx.setLineDash([8, 4]);
    ctx.lineDashOffset = Date.now() / 100 % 12; // Animated dashes
    ctx.strokeRect(r.x - 2, r.y - 2, r.w + 4, r.h + 4);
    ctx.restore();

    // Modern resize handle
    const handleX = r.x + r.w - HANDLE_SIZE;
    const handleY = r.y + r.h - HANDLE_SIZE;

    ctx.save();
    ctx.fillStyle = "#667eea";
    ctx.shadowColor = "rgba(102, 126, 234, 0.5)";
    ctx.shadowBlur = 8;
    ctx.fillRect(handleX, handleY, HANDLE_SIZE, HANDLE_SIZE);

    // Handle highlight
    ctx.fillStyle = "rgba(255, 255, 255, 0.3)";
    ctx.fillRect(handleX, handleY, HANDLE_SIZE / 2, HANDLE_SIZE / 2);
    ctx.restore();
  }
}

function draw() {
  drawGrid();

  for (const r of rectangles) {
    drawRectangle(r, r === selected);
  }
}

function hitTest(x, y) {
  for (let i = rectangles.length - 1; i >= 0; i--) {
    const r = rectangles[i];
    if (x >= r.x && x <= r.x + r.w && y >= r.y && y <= r.y + r.h) {
      return r;
    }
  }
  return null;
}

function updateInfo() {
  if (!selected) {
    info.textContent = "‚ú® Select a rectangle to see details";
    info.style.background = "linear-gradient(135deg, #94a3b8 0%, #64748b 100%)";
    return;
  }
  const wMm = (selected.w * PX_TO_MM).toFixed(1);
  const hMm = (selected.h * PX_TO_MM).toFixed(1);
  info.textContent = `üìê ${wMm} mm √ó ${hMm} mm`;
  info.style.background = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
}

function selectRectangle(r) {
  selected = r;
  draw();
  updateInfo();
  if (selected && /^#[0-9a-f]{6}$/i.test(selected.color)) {
    colorPicker.value = selected.color;
  }
}

function animateRectangleCreation(rect) {
  const startTime = Date.now();
  const duration = 300;
  const initialScale = 0;

  function animate() {
    const elapsed = Date.now() - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const easeOutBack = 1 + 2.7 * Math.pow(progress - 1, 3) + 1.7 * Math.pow(progress - 1, 2);

    const scale = initialScale + (1 - initialScale) * easeOutBack;

    // Store original dimensions
    const originalW = rect.originalW || rect.w;
    const originalH = rect.originalH || rect.h;

    if (!rect.originalW) {
      rect.originalW = rect.w;
      rect.originalH = rect.h;
    }

    // Apply scaling from center
    const centerX = rect.x + originalW / 2;
    const centerY = rect.y + originalH / 2;

    rect.w = originalW * scale;
    rect.h = originalH * scale;
    rect.x = centerX - rect.w / 2;
    rect.y = centerY - rect.h / 2;

    draw();

    if (progress < 1) {
      requestAnimationFrame(animate);
    } else {
      // Cleanup
      delete rect.originalW;
      delete rect.originalH;
    }
  }

  animate();
}

// --- Mouse handlers ---

function onMouseDown(e) {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  const r = hitTest(x, y);

  if (r) {
    selected = r;
    if (x >= r.x + r.w - HANDLE_SIZE && y >= r.y + r.h - HANDLE_SIZE) {
      resizing = true;
      canvas.style.cursor = "nw-resize";
    } else {
      resizing = false;
      canvas.style.cursor = "move";
      dragOffset.x = x - r.x;
      dragOffset.y = y - r.y;
    }
  } else {
    selected = null;
    resizing = false;
    canvas.style.cursor = "default";
  }
  selectRectangle(selected);
}

function onMouseMove(e) {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  // Update cursor based on hover state
  if (!selected || e.buttons !== 1) {
    const hoverRect = hitTest(x, y);
    if (hoverRect) {
      if (x >= hoverRect.x + hoverRect.w - HANDLE_SIZE && y >= hoverRect.y + hoverRect.h - HANDLE_SIZE) {
        canvas.style.cursor = "nw-resize";
      } else {
        canvas.style.cursor = "move";
      }
    } else {
      canvas.style.cursor = "default";
    }
  }

  if (!selected) return;

  if (resizing && e.buttons === 1) {
    selected.w = Math.max(40, x - selected.x);
    selected.h = Math.max(40, y - selected.y);
    draw();
    updateInfo();
  } else if (!resizing && e.buttons === 1) {
    selected.x = Math.max(0, Math.min(canvas.width - selected.w, x - dragOffset.x));
    selected.y = Math.max(0, Math.min(canvas.height - selected.h, y - dragOffset.y));
    draw();
  }
}

function onMouseUp() {
  resizing = false;
  canvas.style.cursor = "default";
}

// --- Toolbar actions ---

addBtn.onclick = () => {
  const color = colorPicker.value || getRandomModernColor();
  const r = {
    x: Math.random() * (canvas.width - 120) + 60,
    y: Math.random() * (canvas.height - 80) + 40,
    w: 100 + Math.random() * 100,
    h: 60 + Math.random() * 60,
    color
  };
  rectangles.push(r);
  selectRectangle(r);
  animateRectangleCreation(r);
};

deleteBtn.onclick = () => {
  if (!selected) return;

  // Smooth fade out animation
  const rectToDelete = selected;
  const startTime = Date.now();
  const duration = 200;

  function fadeOut() {
    const elapsed = Date.now() - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const opacity = 1 - progress;

    ctx.save();
    ctx.globalAlpha = opacity;
    draw();
    ctx.restore();

    if (progress < 1) {
      requestAnimationFrame(fadeOut);
    } else {
      rectangles = rectangles.filter(r => r !== rectToDelete);
      selected = null;
      draw();
      updateInfo();
    }
  }

  fadeOut();
};

colorPicker.addEventListener("input", () => {
  if (selected) {
    selected.color = colorPicker.value;
    draw();
  }
});

// --- Events ---

canvas.addEventListener("mousedown", onMouseDown);
canvas.addEventListener("mousemove", onMouseMove);
canvas.addEventListener("mouseup", onMouseUp);
canvas.addEventListener("mouseleave", onMouseUp);

// Touch support for mobile
canvas.addEventListener("touchstart", (e) => {
  e.preventDefault();
  const touch = e.touches[0];
  const mouseEvent = new MouseEvent("mousedown", {
    clientX: touch.clientX,
    clientY: touch.clientY
  });
  canvas.dispatchEvent(mouseEvent);
});

canvas.addEventListener("touchmove", (e) => {
  e.preventDefault();
  const touch = e.touches[0];
  const mouseEvent = new MouseEvent("mousemove", {
    clientX: touch.clientX,
    clientY: touch.clientY,
    buttons: 1
  });
  canvas.dispatchEvent(mouseEvent);
});

canvas.addEventListener("touchend", (e) => {
  e.preventDefault();
  const mouseEvent = new MouseEvent("mouseup", {});
  canvas.dispatchEvent(mouseEvent);
});

// Keyboard shortcuts
document.addEventListener("keydown", (e) => {
  if (e.key === "Delete" || e.key === "Backspace") {
    if (selected) {
      deleteBtn.click();
    }
  } else if (e.key === "n" || e.key === "N") {
    addBtn.click();
  }
});

// Initial draw with welcome animation
setTimeout(() => {
  draw();
  updateInfo();
}, 100);

// Add a welcome rectangle
setTimeout(() => {
  const welcomeRect = {
    x: canvas.width / 2 - 100,
    y: canvas.height / 2 - 40,
    w: 200,
    h: 80,
    color: "#667eea"
  };
  rectangles.push(welcomeRect);
  selectRectangle(welcomeRect);
  animateRectangleCreation(welcomeRect);
}, 500);
</script>

</body>
</html>